## BroadcastChannel

1. **创建广播域**：

   - 使用 `new BroadcastChannel('channel_name')` 创建或连接到一个广播频道。

2. **同源条件**：

   - `BroadcastChannel` 只在同源策略下工作。

3. **数据通信**：

   - 使用 `channel.postMessage(message)` 发送消息。
   - 使用 `channel.onmessage` 接收消息。

4. **简单消息传递**：

   - `BroadcastChannel` 适用于简单的消息传递。
   - 如果需要更复杂的通信，可以考虑使用 `WebSocket` 或 `Service Worker`。

5. **关闭频道**：

   - 使用 `channel.close()` 关闭频道。

   

`窗口/Tab A`

```html
<!DOCTYPE html>
<html>
<head>
    <title>Tab A</title>
</head>
<body>
    <h1>Tab A</h1>
    <script>
      	// 创建名为my_channel的广播域频道
        // 没有该频道，就创建该频道，如果存在该频道，则直接所使用该频道
        const channel = new BroadcastChannel('my_channel');

        // 发送消息
        channel.postMessage('Hello from Tab A!');

        // 接收消息
        channel.onmessage = function(event) {
            console.log('Tab A received:', event.data);
        };
    </script>
</body>
</html>
```



`窗口/Tab B`

```html
<!DOCTYPE html>
<html>
<head>
    <title>Tab B</title>
</head>
<body>
    <h1>Tab B</h1>
    <script>
        const channel = new BroadcastChannel('my_channel');

        // 发送消息
        channel.postMessage('Hello from Tab B!');

        // 接收消息
        channel.onmessage = function(event) {
          	// 传入数据在data属性中
            console.log('Tab B received:', event.data);
        };
      
      
      	setTimeout(() => {
          // 关闭频道
          channel.close();
        }, 60 * 1000 * 24)
    </script>
</body>
</html>
```



## postMessage

`postMessage` 是一种允许跨源（cross-origin）通信的 Web API 方法，通常用于在不同的窗口、iframe 或者同一个页面中不同的文档之间发送消息

```js
window.postMessage(message, targetOrigin)
```

+ `message`: 你希望传递的数据。可以是一个字符串或者是可以被结构化克隆的对象。
+ `targetOrigin`: 
  1. 希望传递消息的目标窗口的源（协议+域名+端口号）
  2.  `*`表示可以发送到任何源。但是为了安全，最好指定具体的源



### 结构化克隆算法

结构化克隆算法是Web API中用于深度复制对象的一个算法，它能够处理多种数据类型，但也有其局限性。具体来说：

1. **支持克隆的类型**：
   - 基本数据类型（如字符串、数字、布尔值、null、undefined、Symbol）
   - 普通对象（Object）
   - 数组（Array）
   - `Map` 和 `Set`
   - `ArrayBuffer`、`Blob`、`File`、`Date`、`RegExp`等
2. **不支持克隆的类型**：
   - DOM对象（如元素、节点等）
   - 函数和方法
   - `Proxy`对象
   - `WeakSet` 和 `WeakMap`



`示例`

**主页面代码**

```js
const iframe = document.getElementById('myIframe');

// 通过iframe的contentWindow 获取iframe渲染的窗口
iframe.contentWindow.postMessage('Hello from parent!', 'https://example.com');
```



**iframe 页面代码**

```js
window.addEventListener('message', function(event) {
    // 对数据来源进行核实
    if (event.origin !== 'https://yourdomain.com') {
        return;
    }
    
  	// 数据存在data属性中
    console.log('Received message:', event.data);
});
```



