## 定时器

JavaScript中有两种定时器:

1. setTimeout --- clearTimeout
2. setInterval --- clearInterval

`setTimeout`和`setInterval` 具有如下特点:

1. node 和 浏览器 都支持

2. 都是宏任务 --- 需要等待微任务执行完成才会被回调，所以时间并不是特别准确

3. `setTimeout`和`setInterval`都支持如下参数 

   + callback function
   + 延迟毫秒值 --- 默认是0
   + 后续参数都是传递给callback function的参数

4. `setTimeout`和`setInterval`的返回都是数值类型的定时器标识符

   可以传递给`clearTimeout`和`clearInterval`, 用于清除定时器

5. `clearTimeout`和`clearInterval`的参数是定时器标识

   + 如果标识存在，则清除对应定时器
   + 如果标识不存在，则静默失效



## requestAnimationFrame

`requestAnimationFrame` 主要设计用于优化动画渲染。它允许浏览器在下一个重绘（repaint）之前调用指定的回调函数，这样可以确保动画与屏幕刷新率同步，从而实现更平滑的动画效果

虽然 `requestAnimationFrame` 不是传统的定时器，但`requestAnimationFrame`的实现机制和定时器类似，所以也可以用来实现对应的定时器效果



如果浏览器的刷新频率是 60Hz，这意味着浏览器在一秒钟内可以刷新 60 次

`requestAnimationFrame`的参数是一个回调函数，每当显示器准备更新画面时，浏览器就会调用这个回调函数

在正常情况下，如果浏览器的刷新率是 60Hz，`requestAnimationFrame` 的回调函数会在一秒钟内被调用 60 次左右。但由于实际的运行环境，可能存在一定的变动 「 如掉帧等情况，会导致回调次数不足60次 」。

可以认为`requestAnimationFrame`是timer固定的`setTimeout`



因为`requestAnimationFrame`会在浏览器刷新前被回调，所以可以最大可能去减少浏览器的重绘和回流

因此可以通过`requestAnimationFrame`来实现更加平稳和顺滑的动画效果



同时浏览器对`requestAnimationFrame`进行了相应的优化操作:

1. 非活跃页面，`requestAnimationFrame`停止回调，直到页面恢复
2. 对于隐藏元素，`requestAnimationFrame`会静默失效 「 对这类元素执行动画没有任何意义 」



和setTimeout一样，requestAnimationFrame 也会返回一个number类型的定时器标识

```js
const timer = requestAnimationFrame(function fn() {

  console.log('requestAnimationFrame被回调了')

  // 默认情况下，requestAnimationFrame效果类似于setTimout
  // 如果要执行类似于setInterval效果，需要自己进行递归
  requestAnimationFrame(fn)
})

// 使用timer清除requestAnimationFrame方法
cancelAnimationFrame(timer)
```

