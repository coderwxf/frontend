## V8执行流程

1. google使用C++编写的开源JavaScript引擎
2. 可以单独运行，也可以其嵌入其它C++程序 「 如浏览器或node 」
3. 跨平台
4. 可以运行JavaScript和WebAssembly

![image.png](https://s2.loli.net/2024/08/25/5VfX7JK4QuWTzmE.png) 

1. 浏览器通过网络请求，缓存等形式拿到JavaScript代码后，以字节流的形式进行读取

2. 通过Pares模块(解析模块) 进行 词法分析和语法分析，并转换为AST (抽象语法树)

3. Ignition（解释器）将AST转换为字节码并执行

   + 在执行过程中，Ignition会收集运行时信息，如变量类型等

4. 在执行过程中，Ignition会收集运行时信息，如变量类型等

   + 对于热点函数，TurboFan( 优化编译器 )将字节码转换为优化的机器码，以提高执行效率

   + 如果运行时发现优化后的机器码不再适用（如类型变化），会进行反优化，将机器码转换回字节码（deoptimization）。

   + 这种在运行时进行部分编译和优化的行为被称为即时编译（JIT，Just-In-Time Compilation）

     「 动态编译，实时优化 」



### 字节码

字节码（Bytecode）是某些编程语言（如Java、Python等）在源代码编译后生成的一种中间表示形式。它介于源代码和机器码之间，通常由虚拟机（如JVM、PVM）来解释和执行。

字节码的设计使得程序具有跨平台的能力，不同平台上会有相应的虚拟机实现，这些虚拟机能够理解和执行相同的字节码。这样，开发者只需编写和编译一次代码，就能在多种平台上运行，而无需针对每个平台进行单独编译。

相较于直接解释源代码，执行字节码的效率更高。因为字节码已经经过一次编译，消除了部分解析和检查步骤，从而加快了执行速度。此外，虚拟机在运行字节码时，通常会使用JIT（即时编译）技术，将频繁执行的字节码动态编译成机器码并存在对应的反优化操作 「 字节码使机器码反编译为字节码成为了可能 」，以进一步优化性能。

