![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ea2f6da05db4cb386b6302779e66c75~tplv-k3u1fbpfcp-zoom-1.image#?w=716\&h=263\&s=76315\&e=png\&b=fcfcfc) 

![image.png](https://s2.loli.net/2024/08/25/Ul9LzpNBPqOsCcY.png) 

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1773ad1f0ac945edb563657475936f90~tplv-k3u1fbpfcp-zoom-1.image#?w=1861\&h=888\&s=357950\&e=png\&b=fdfbfb) 



（1）解析 HTML 文件，构建 DOM (文档对象模型) 树

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f088d049b54040558ea4745130d440af~tplv-k3u1fbpfcp-zoom-1.image#?w=2283\&h=652\&s=243851\&e=png\&b=fefefe) 

（2）解析 CSS 文件，构建 CSSOM (样式对象模型) 树。

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/537d3023efb54cab98ccee9519ad5ee3~tplv-k3u1fbpfcp-zoom-1.image#?w=2019\&h=556\&s=235008\&e=png\&b=fcfcfc) 

（3）将 DOM 树和 CSSOM 树合并成渲染树(render tree)。

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/98569e85c1cc4b96980d4db42bef64c7~tplv-k3u1fbpfcp-zoom-1.image#?w=1505\&h=702\&s=424097\&e=png\&b=fdfcfc) 

（4）浏览器根据渲染树和设备信息（如屏幕大小、分辨率等），计算每个节点的实际样式（computed style）。接着，浏览器会生成几何体（frame），这是浏览器内部渲染所需要使用到的数据结构。

「 这个过程叫 布局 layout 」

（5）浏览器将几何体转换成实际的屏幕像素，并进行绘制，呈现出最终的页面。

「 这个过程叫 绘制 paint 」



1. CSS不会阻塞DOM树渲染，但会阻塞render tree 生成
2. CSS阻塞render tree存在超时时间，超时后render tree 将不在等待CSSOM 「 如对应CSS文件不存在 」
3. render tree 和 DOM不是一一对应的 「 display: none 元素不需要存在于render tree上 」
4. 将DOM和CSSOM组合在一起的过程称之为`attachment`
5. 我们可以通过浏览器的开发者工具中的 "Layout" 页签（位于 "更多工具" -> "More Tools" 中），查看网页渲染图层的组成结构。



## 重绘和回流

### 回流 (reflow)

1. 回流又叫重排
2. 除第一次布局外的，所有布局操作都叫回流
3. 发生原因
   + DOM结构发生改变等导致布局发生了改变
   + 浏览器窗口 resize 了
   + `getComputedStyle` 和 `getBoundingClientRect` 等方法 为了获取实时数据，在每次获取值之前都会回流

回流意味着要重新layout 和 paint，比较消耗性能



### 重绘 (repaint)

1. 除第一次paint外的所有paint，都叫重绘
2. 发生原因： 样式的改变



**避免方式**

1. 减少修改次数
   + 通过`cssText`或样式类来设置样式 「 修改样式时尽量一次性修改 」
   + 通过`DocumentFragment`来操作DOM  「 DOM操作尽可能在内存中执行完后，仅实际渲染一次 」
   + 避免经常使用`getComputedStyle` 和 `getBoundingClientRect` 等方法
   + 将需要经常变动的元素 变为绝对定位元素(absolute 和 fixed)
     + 绝对定位元素会脱标，开启一个新的render layout，从而减少重绘和回流影响范围



## 合成层

1. 浏览器在实际渲染时进行的优化操作
2. 将多个图层合并成一个图层，从而减少需要渲染的图层数量
3. 每一个合成层渲染时都会开启GPU加速 「 硬件加速 」

我们可以将需要频繁变动的部分，单独开启一个合成层(composited layout 复合图层)， 从而减少其回流和重绘带来的影响

但合成层的本质是消耗内存来提升性能 「 需要内存空间来维护和管理合成层，不能滥用 」

会单独开启合成层的条件

1. 3D transforms
2. video、canvas、iframe
3. 对opacity、transform进行CSS动画的动画执行过程中
   + 只有执行过程中才会开启合成层，开始前和结束后并不产生新的合成层
4. fixed element 「 position: fixed 」





---



a元素默认跳转问题

index.html 入口文件