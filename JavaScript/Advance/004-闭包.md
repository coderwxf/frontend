闭包(英语:Closure)，又称**词法闭包**(Lexical Closure)或**函数闭包**(function closures)

任何一个函数式编程语言都支持闭包



广义闭包，一个函数可以访问外部变量，就构成了闭包

狭义闭包，一个函数只有实际使用了外部变量，才会构成闭包



JavaScript中通过作用域链来查找变量，作用域链是在代码编译时就已确定，所以是词法作用域，所构成的闭包也叫词法闭包

闭包会导致函数和其所对应的词法环境无法有效被GC回收，所以需要注意内存泄露，如有必要需要手动进行清理

```js
function createAdder(count) {
  function adder(num) {
    // adder函数内部使用了自由变量count, 所以构成了狭义上的闭包
    return count + num
  }

  return adder
}

var adder5 = createAdder(5)
adder5(100)

// 对于闭包，我们需要手动释放对应的内存空间
adder5 = null
```



原则上，对应的所有词法环境都需要被保留，但浏览器进行了优化，只有被访问的外部变量才会被保留

```js
function fun() {
  let name = 'Klaus'
  let age = 24
  let address = 'shanghai'

  return function() {
    // 此时浏览器会在执行返回的函数时被停止 「 控制台的作用域是返回函数所在的函数作用域 」
    // 可以在控制台中尝试输出name和age以及address查看对应变量是否存在以及对应值
    debugger

    console.log(name, age)
  }
}

fun()() // => Klaus 24
```

