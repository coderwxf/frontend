宿主环境是多进程的且每一个进程都是多线程的，而JavaScript是单线程的

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c186054f61174e61be3614703e49aa10~tplv-k3u1fbpfcp-zoom-1.image) 



事件循环中并非只维护着一个队列，事件队列由宏任务和微任务共同组成 

| 任务                          | 说明                                                         |
| ----------------------------- | ------------------------------------------------------------ |
| 宏任务队列（macrotask queue） | ajax、setTimeout、setInterval、DOM监听、UI Rendering等       |
| 微任务队列（microtask queue） | Promise的回调函数、 Mutation Observer API、queueMicrotask()等 |



对应队列的执行顺序：

1. main script中的代码优先执行
2. 在执行任何一个宏任务之前（不是队列，是一个宏任务），都会先查看微任务队列中是否有任务需要执行
   + 也就是宏任务执行之前，必须保证微任务队列是空的
   + 如果不为空，那么就优先执行微任务队列中的任务（回调）



`示例`

```js
console.log('start');

await Promise.resolve().then(() => {
    console.log('promise3');
});

console.log('end');

/*
  start
  promise3
  end
*/
```



`await` 后需要跟上一个Promise实例 「 如果不是，使用`Promise.resolve`包裹 」

`await`后边的等价于`promise的executor函数中同步执行代码`，会被同步回调

`await`下一行的等价于`then`回调中的代码

```js
await Promise.resolve().then(() => {
    console.log('promise3');
});

console.log('end');
```

等价于

```js
Promise.resolve().then(() => {
    console.log('promise3');
}).then(() => console.log('end'))
```



```js
await 3

console.log('end');
```

等价于

```js
await Promise.resolve(3).then(() => console.log('end');)
```

