## dispatch

组件通过dispatch方法，派发对应事件，从而实现store状态更新

```js
store.dispatch({
  type: 'INCREMENT',
  payload: {
    step: 1
  }
})
```



`参数传递的不同方式`

```js
// 方式一
dispatch({
  type: 'INCREMENT',
  setp: 10
})
```

```js
// 方式二 --- 推荐
dispatch({
  type: 'INCREMENT',
  // 参数对象 --- 将所有参数放在一起，并统一进行管理
  payload: {
    setp: 10
  }
})
```



## subscribe

1. `subscribe`是位于`store`上的一个方法，该方法接收一个函数作为参数
2. 调用`subscribe`后，会将参数`cb`传入store存入store对象的事件池中
3. 当store发生了更新，会自动依次执行事件池中的方法
4. subscribe方法会返回一个取消订阅方法 -- 通过该函数可以将加入到事件池中的对应事件从事件池中移除掉
5. redux通过对reducer返回的新旧state进行浅比较来识别状态是否发生了更新，所以reducer必须是一个纯函数

```js
useEffect(() => {
  const unSubscribe = store.subscribe(() => setNum(new Date()))

  // const unSubscribe = store.subscribe(cb)
  // 此时unSubscribe只能清除cb --- 事件清理函数和事件池插入函数是一一对应的关系
  return () => unSubscribe()
}, [])
```



## 示例

`themeContext.js`

```js
import { createContext } from 'react'
export default createContext()
```



`app.js`

```jsx
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App'
import store from './store'
import ThemeContext from './ThemeContext'

const root = ReactDOM.createRoot(document.getElementById('root'));

root.render(
  // 通过context 全局注入store
  <ThemeContext.Provider value={store}>
    <App />
  </ThemeContext.Provider>
);
```



`Count.jsx`

```jsx
import React, { memo, useContext, useMemo, useState } from 'react'
import ThemeContext from './ThemeContext'

const Count = memo(() => {
  const [_, setNum] = useState(0)
  const store = useContext(ThemeContext)

  // 通过getState 获取最新的状态值
  const { count } = store.getState()
  const dblCount = useMemo(() => count * 2, [count])

 // 确保store不会被重复订阅
  useEffect(() => {
    const unSubscribe = store.subscribe(() => {
      // 通过更新组件状态，实现让react重新渲染组件的目的 --- 功能类似于forceUpdate
      setNum(new Date())
    })
  }, [])
  
  function add() {
    // 组件通过dispatch方法，派发对应事件，从而实现store状态更新
    store.dispatch({
      type: 'INCREMENT',
      payload: {
        step: 1
      }
    })
  }

  return (
    <>
      <div>count: { count }</div>
      <div>doubule count: { dblCount }</div>
    	<button onClick={add}>add</button>
    </>
  )
})

export default Count
```



