`react-redux` 并不改变`redux`的定义方式，而是简化`redux`在`react`中的使用方式

1. 在入口文件中使用 Provider 组件传递 store，而不需要手动创建和传递上下文对象
2. 在各个组件中使用 connect 函数进行状态绑定，而不需要手动获取上下文对象和处理组件更新



## 自动注入

```js
import { Provider } from 'react-redux'

// 注入的key名叫store
<Provider store={store}>
  <Count />
  <Vote />
</Provider>
```



## 组件使用

```jsx
import { memo } from 'react'
import { connect } from 'react-redux'
// action creator还是要导入的 -- 便于传参
import { actions } from './store'

// 返回 state对象 (状态对象)
function mapStateToProps(state) {
  return {
    count: state.count.count
  }
}

// 返回 dispatch对象 (派发事件对象)
function mapDispatchToProps(dispatch) {
  return {
    increment(step) {
      dispatch(actions.count.increment(step))
    },
    decrement(step) {
      dispatch(actions.count.decrement(step))
    }
  }
}

const Count = memo(props => {
  const { count, increment, decrement } = props

  return (
   <>
    <h2>count: { count }</h2>
    <button onClick={() => increment(5)}>add 5</button>
    <button onClick={() => decrement(5)}>sub 5</button>
   </>
  )
})

// 通过connect函数将需要使用的state和dispatch方法注入到prop中
export default connect(mapStateToProps, mapDispatchToProps)(Count)
```



## bindActionCreators

`bindActionCreators`是`redux`提供的工具性函数(helper function)

1. 如果参数是action creator，返回派发方法
2. 如果参数是action creator对象，转换为派发方法对象后返回



上述示例中

```js
function mapDispatchToProps(dispatch) {
  return {
    increment(step) {
      dispatch(actions.count.increment(step))
    },
    decrement(step) {
      dispatch(actions.count.decrement(step))
    }
  }
}
```

可以被改写为

```js
import { bindActionCreators } from 'redux'

function mapDispatchToProps(dispatch) {
  // 自动执行派发对应方法，并传入对应参数
  return bindActionCreators({
    increment: actions.count.increment,
    decrement: actions.count.decrement
  }, dispatch)
}
```



在connect方法中，如果第二个参数传入的不是方法，而是一个对象时, 会自动调用`mapDispatchToProps`进行处理

所以上述代码可以被继续修改为

```js
export default connect(mapStateToProps, {
  increment: actions.count.increment,
  decrement: actions.count.decrement
})(Count)
```



`bindActionCreators`的源码实现

```js
// 传入方法，返回方法。传入对象，返回对象
function bindActionCreators(actionCreators, dispatch) {
  if (typeof actionCreators === 'function') {
    return bindActionCreator(actionCreators, dispatch);
  }

  if (typeof actionCreators !== 'object' || actionCreators === null) {
    throw new Error(...); 
  }

  const boundActionCreators = {};
  
  for (const key in actionCreators) {
    const actionCreator = actionCreators[key];
    
    if (typeof actionCreator === 'function') {
      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch);
    }
  }
  return boundActionCreators;
}

// 将action creator方法转换为派发方法
// 派发方法会派发 action creator并传入对应参数
function bindActionCreator(actionCreator, dispatch) {
  return function() {
    return dispatch(actionCreator.apply(this, arguments));
  };
}
```

