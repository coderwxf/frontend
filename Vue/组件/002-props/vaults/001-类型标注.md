## 使用 `<script setup>`

当使用 `<script setup>` 时，`defineProps()` 宏函数支持从它的参数中推导类型

这也被称之为**运行时声明**，因为传递给 `defineProps()` 的参数会作为运行时的 `props` 选项使用

```ts
const props = defineProps({
  foo: { type: String, required: true },
  bar: Number
})

props.foo // string
props.bar // number | undefined
```



然而，通过泛型参数来定义 props 的类型通常更直接, 这也被称之为**基于类型的声明**

编译器会尽可能地尝试根据类型参数推导出等价的运行时选项

```ts
const props = defineProps<{
  foo: string
  bar?: number
}>()
```



> 基于类型的声明或者运行时声明可以择一使用，但是不能同时使用。



### 语法限制

传递给`defineProps`的类型可以是类型文字(如Number，String等)，也可以是本地接口或者说是从别的文件中引入的接口

```ts
interface Props {
  foo: string
  bar?: number
}

const props = defineProps<Props>()
```



但是因为声明式类型转换为运行时类型是基于AST的，所以那些需要根据上下文进行类型分析的复杂类型，如条件类型，并不被支持

可以使用条件类型来指定单个 prop 的类型，但不能用于整个 props 对象的类型



### 默认值

当使用基于类型的声明时，我们需要通过`withDefaults`这个宏函数来辅助我们添加props的默认值

```ts
export interface Props {
  msg?: string
  labels?: string[]
}

const defaultProps = {
  msg: 'hello',
  labels: () => ['one', 'two']
}

// 因为设置了默认值，所以Props中的可选属性将会被剔除
const props = withDefaults(defineProps<Props>(), defaultProps)
```



## 非 `<script setup>` 

如果没有使用 `<script setup>`，那么为了开启 props 的类型推导，必须使用 `defineComponent()`

```ts
import { defineComponent } from 'vue'

// defineComponent为传入的options 对象提供类型约束和类型提示
export default defineComponent({
  props: {
    message: String
  },
  // props会作为setup的第一个参数被传入
  setup(props) {
    // props对象的类型会根据props选项的值进行推导
    props.message // <-- 类型：string
  }
})
```



## 复杂的props类型

通过基于类型的声明，一个引用类型props 可以很方便的进行类型约束

```ts
interface Book {
  title: string
  author: string
  year: number
}

const props = defineProps<{
  book: Book
}>()
```



但是对于运行时声明，一个引用类型props往往只能被推导为`Object`，`Function`和`Array`类型，无法被推导为更为具体的类型

为了解决整个问题，vue提供了`PropType`

```ts
import type { PropType } from 'vue'

interface Book {
  title: string
  author: string
  year: number
}

const props = defineProps({
  // 转换wield更为具体的类型
  book: Object as PropType<Book>
})
```



`PropType`选项也可以被用于props选项

```ts
import { defineComponent } from 'vue'
import type { PropType } from 'vue'

export default defineComponent({
  props: {
    book: Object as PropType<Book>
  }
})
```

