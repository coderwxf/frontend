在 Vue 应用的概念中，“组合式函数”(Composables) 是一个利用 Vue 的组合式 API 来封装和复用**有状态逻辑**的函数

如果我们抽取的公共函数中使用了hook函数来定义和管理状态，这个公共函数就被称之为组合式函数

组合式函数本质其实就是自定义hook函数



当构建前端应用时，我们常常需要复用公共任务的逻辑。例如为了在不同地方格式化时间，我们可能会抽取一个可复用的日期格式化函数。这个函数封装了**无状态的逻辑**：它在接收一些输入后立刻返回所期望的输出



相比之下，有状态逻辑负责管理会随时间而变化的状态。

- 无状态逻辑更像是一个纯函数,只根据输入计算结果。
- 有状态逻辑更像是一个过程,内部有状态在变化, 根据当前状态做计算



```ts
// mouse.js
import { ref, onMounted, onUnmounted } from 'vue'

// 按照惯例，组合式函数名以“use”开头
export function useMouse() {
  // 被组合式函数封装和管理的状态
  const x = ref(0)
  const y = ref(0)

  // 组合式函数可以随时更改其状态。
  function update(event) {
    x.value = event.pageX
    y.value = event.pageY
  }

  // 一个组合式函数也可以挂靠在所属组件的生命周期上来启动和卸载副作用
  onMounted(() => window.addEventListener('mousemove', update))
  onUnmounted(() => window.removeEventListener('mousemove', update))

  // 通过返回值暴露所管理的状态
  return { x, y }
}
```

我们做的只是把操作状态的逻辑封装为一个函数，并将其移动到一个外部的函数中，并返回需要暴露的状态

也可以在组合式函数中使用所有的[组合式 API](https://cn.vuejs.org/api/#composition-api)

更酷的是，你还可以嵌套多个组合式函数：一个组合式函数可以调用一个或多个其他的组合式函数、

这使得我们可以像使用多个组件组合成整个应用一样，用多个较小且逻辑独立的单元来组合形成复杂的逻辑。

实际上，这正是为什么我们决定将实现了这一设计模式的 API 集合命名为组合式 API



如果将公共逻辑抽取出来，叫做公共函数
如果这个函数中操作了响应式状态 那么这个函数就被称之为组合式函数
一个逻辑可以通过组合式函数拆分为一个个的小函数，通过这些函数的整合
就可以完成整个逻辑功能 所以这些函数被称之为组合式函数



```ts
// fetch.js
import { ref, watchEffect, toValue } from 'vue'

export function useFetch(url) {
  const data = ref(null)
  const error = ref(null)

  watchEffect(() => {
    // 在 fetch 之前重置状态
    data.value = null
    error.value = null
    // toValue() 将可能的 ref 或 getter 解包
    fetch(toValue(url))
      .then((res) => res.json())
      .then((json) => (data.value = json))
      .catch((err) => (error.value = err))
  })

  return { data, error }
}
```

`toValue()` 是一个在 3.3 版本中新增的 API。它的设计目的是将 ref 或 getter 规范化为值。如果参数是 ref，它会返回 ref 的值；如果参数是函数，它会调用函数并返回其返回值。否则，它会原样返回参数。它的工作方式类似于 [`unref()`](https://cn.vuejs.org/api/reactivity-utilities.html#unref)，但对函数有特殊处理。



## 约定和最佳实践

### 命名

组合式函数约定用驼峰命名法命名，并以“use”作为开头。



