通过`import.meta.env`对象获取对应环境变量

![image-20240408173658764](https://s2.loli.net/2024/04/08/TdywhMF4eNYRXGt.png) 



## `.env` 文件

通过[dotenv](https://github.com/motdotla/dotenv)从环境目录中「 默认就是项目根目录 」加载额外的环境变量

```shell
.env                # 所有情况下都会加载
.env.local          # 所有情况下都会加载，但会被 git 忽略
.env.[mode]         # 只在指定模式下加载
.env.[mode].local   # 只在指定模式下加载，但会被 git 忽略
```

1. vite内置环境变量优先级最高，无法被覆盖
2. 用于指定模式的文件（例如 `.env.production`）会比通用形式的优先级更高（例如 `.env`）
3. `.env` 类文件会在 Vite 启动一开始时被加载，而改动会在重启服务器后生效

```shell
VITE_SOME_KEY=123  # VITE_ 开头的变量会暴露给客户端
DB_PASSWORD=foobar # 不以VITE_开头的变量不会暴露给客户端
```

客户端可以通过`import.meta.env`获取注入的环境变量

通过`import.meta.env.xxx`获取到的值都是字符串类型



## 在html中使用

Vite 支持在 HTML 文件中使用环境变量

你可以在 HTML 中通过 `%ENV_NAME%` 这样的特殊格式来使用 `import.meta.env` 里的属性

```html
<h1>Vite 正在运行于 %MODE%</h1>
<p>正在使用数据来自 %VITE_API_URL%</p>
```

如果对应环境变量不存在，那么 Vite 将不会对这个占位符做任何替换，它将保持原样显示

如果需要使用更复杂的替换功能，例如条件性的变量替换，需要借助第三方社区插件



## 自定义模式

默认情况下

+ 当执行 `vite build` 时，它会自动加载 `.env.production` 中可能存在的环境变量
+ 当执行 `vite dev` 时，它会自动加载 `.env.development` 中可能存在的环境变量

```shell
vite build --mode staging # 通过mode自定义模式类型 --- 自动加载 .env.staging
```



## NODE_ENV

`NODE_ENV` 是一个在 Node.js 环境中常用的环境变量，用于指定 Node.js 应用运行的环境

可以通过 `process.env.NODE_ENV` 访问这个变量的值



vite本质也是在node环境下对源码进行构建

所以vite中既可以使用mode，也可以使用`NODE_ENV`，但他们是完全不同的两种东西

+ `NODE_ENV`是node环境中通用概念
+ `mode`是Vite中特有概念

![image-20240408181200874](https://s2.loli.net/2024/04/08/Di4QNbcJ2Ws9Mtz.png) 

```shell
# 1. NODE_ENV=development 先设置环境变量
# 2. vite build 再启动开发服务器
NODE_ENV=development vite build

# A=B --- shell中设置环境变量的方式
# NODE_ENV=development 设置的环境变量在当前命令执行环境中是临时有效的
# 如果运行环境是 Node.js，可以通过 process.env 对象来获取到这些环境变量
```

![image-20240408182504787](https://s2.loli.net/2024/04/08/lYjFDdCWKatH9SI.png) 

+ `NODE_ENV`修改的是`import.meta.env.PROD`和`import.meta.env.DEV`
+ `--mode`设置的是`import.meta.env.MODE`

> 因此如果自定义模式，推荐同时设置`NODE_ENV`和`--mode`